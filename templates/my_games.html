<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Selected Games</title>
  <link href="https://fonts.googleapis.com/css2?family=Anton&display=swap" rel="stylesheet" />
  <link rel="stylesheet"
      href="{{ url_for('static', filename='styles.css') }}">

  <style>
    /* ——— page framing ——— */
    body           { font-family:'Anton',sans-serif; background:#1a1a1a; color:#fff; text-align:center; padding:2rem; }
    h1             { font-size:2.3rem; color:#ff4500; margin-bottom:0.6rem; }
    p              { margin-bottom:1.8rem; }

    /* ——— card grid ——— */
    #gamesContainer{ display:flex; flex-wrap:wrap; gap:1rem; justify-content:center; }

    /* re-use main card look; add left-side checkbox */
    .game-card     { background:#fff6f2; color:#222; width:270px; padding:1rem 1rem 1.3rem; border-radius:8px; position:relative; }
    .game-card input[type="checkbox"]{
       position:absolute; top:12px; left:12px; transform:scale(1.35); cursor:pointer;
    }
    .game-header   { display:flex; align-items:center; justify-content:space-between; margin-bottom:0.5rem; }
    .team-logo     { width:40px; height:40px; }
    .game-title    { font-size:1.05rem; }
    .game-meta     { font-size:0.85rem; opacity:0.80; }
    .game-score { font-size:1rem; font-weight:bold; color:#000; margin-top:2px; }

  </style>
</head>
<body>

  <h1>Your Selected Games</h1>
  <p>Un-tick any game to remove it from your list.</p>
  <div id="gamesContainer"></div>

<script>
/* keep one copy of the containers & logos */
const container  = document.getElementById("gamesContainer");
const teamLogos  = JSON.parse(localStorage.getItem("teamLogos") || "{}");

/* Helper: pull the latest data from localStorage into memory */
function loadState() {
  const ids  = JSON.parse(localStorage.getItem("selectedGameIds")   || "[]");
  const info = JSON.parse(localStorage.getItem("selectedGamesInfo") || "{}");

  // refresh the Set and the info object in-place
  selectedGameIds.clear();
  ids.forEach(id => selectedGameIds.add(id));

  Object.keys(selectedGamesInfo).forEach(k => delete selectedGamesInfo[k]);
  Object.assign(selectedGamesInfo, info);
}

/* in-memory caches */
const selectedGameIds   = new Set();
const selectedGamesInfo = {};

/* ---------- UI renderer ---------- */
function renderCards() {
  loadState();                                   // ① NEW: always refresh state

  container.innerHTML = "";
  if (selectedGameIds.size === 0) {
    container.innerHTML = "<p style='color:#ccc'>No games selected.</p>";
    return;
  }

  selectedGameIds.forEach(id => {
    const g = selectedGamesInfo[id];
    if (!g) return;  // safety

    const { game_id, away_team, home_team,
            location, hour, date,
            away_score, home_score } = g;

    const card = document.createElement("div");
    card.className = "game-card";

    /* checkbox */
    const checkbox = document.createElement("input");
    checkbox.type = "checkbox";
    checkbox.checked = true;
    checkbox.onchange = () => {
      selectedGameIds.delete(game_id);
      delete selectedGamesInfo[game_id];
      localStorage.setItem("selectedGameIds",   JSON.stringify([...selectedGameIds]));
      localStorage.setItem("selectedGamesInfo", JSON.stringify(selectedGamesInfo));
      card.remove();
      // no manual event needed: the real storage event will notify the opener
    };
    card.appendChild(checkbox);

    /* header */
    const header = document.createElement("div");
    header.className = "game-header";

    const logo1 = document.createElement("img");
    logo1.className = "team-logo";
    logo1.src = teamLogos[away_team] || "";
    logo1.alt = away_team;

    const logo2 = document.createElement("img");
    logo2.className = "team-logo";
    logo2.src = teamLogos[home_team] || "";
    logo2.alt = home_team;

    const title = document.createElement("div");
    title.className = "game-title";
    title.innerHTML = `
        <div>${away_team} vs ${home_team}</div>
        <div class="game-score">${away_score} : ${home_score}</div>
    `;

    header.appendChild(logo1);
    header.appendChild(title);
    header.appendChild(logo2);
    card.appendChild(header);

    /* meta */
    const meta = document.createElement("div");
    meta.className = "game-meta";
    meta.innerText = `${date || "-"} – ${location} – ${hour}`;
    card.appendChild(meta);

    container.appendChild(card);
  });
}

/* first paint */
renderCards();

/* ---------- live sync with other windows ---------- */
window.addEventListener("storage", (e) => {
  if (e.key === "selectedGameIds" || e.key === "selectedGamesInfo") {
    renderCards();         // ② rerender on every relevant change
  }
});
</script>


</body>
</html>
