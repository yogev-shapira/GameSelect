<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Selected Games</title>
  <link href="https://fonts.googleapis.com/css2?family=Anton&display=swap" rel="stylesheet" />
  <link rel="stylesheet"
      href="{{ url_for('static', filename='styles.css') }}">

  <style>
    /* ——— page framing ——— */
    body           { font-family:'Anton',sans-serif; background:#1a1a1a; color:#fff; text-align:center; padding:2rem; }
    h1             { font-size:2.3rem; color:#ff4500; margin-bottom:0.6rem; }
    p              { margin-bottom:1.8rem; }

    /* ——— card grid ——— */
    #gamesContainer{ display:flex; flex-wrap:wrap; gap:1rem; justify-content:center; }

    /* re-use main card look; add left-side checkbox */
    .game-card     { background:#fff6f2; color:#222; width:270px; padding:1rem 1rem 1.3rem; border-radius:8px; position:relative; }
    .game-card input[type="checkbox"]{
       position:absolute; top:12px; left:12px; transform:scale(1.35); cursor:pointer;
    }
    .game-header   { display:flex; align-items:center; justify-content:space-between; margin-bottom:0.5rem; }
    .team-logo     { width:40px; height:40px; }
    .game-title    { font-size:1.05rem; }
    .game-meta     { font-size:0.85rem; opacity:0.80; }
  </style>
</head>
<body>

  <h1>Your Selected Games</h1>
  <p>Un-tick any game to remove it from your list.</p>
  <div id="gamesContainer"></div>

  <script>
  /* ---------- pull stored data ---------- */
  const selectedGameIds   = new Set(JSON.parse(localStorage.getItem("selectedGameIds")   || "[]"));
  const selectedGamesInfo =        JSON.parse(localStorage.getItem("selectedGamesInfo") || "{}");
  console.log("Selected Game IDs:", Array.from(selectedGameIds));
  /* optional: logos cached by main page so we don't repeat a huge object here */
  const teamLogos         = JSON.parse(localStorage.getItem("teamLogos") || "{}");

  const container = document.getElementById("gamesContainer");

  function renderCards(){
      container.innerHTML = "";
      if (selectedGameIds.size === 0){
          container.innerHTML = "<p style='color:#ccc'>No games selected.</p>";
          return;
      }
      selectedGameIds.forEach(id => {
          const g = selectedGamesInfo[id];
          if (!g) return;              // safety
          const { game_id, away_team, home_team, location, hour, date } = g;

          /* card shell */
          const card = document.createElement("div");
          card.className = "game-card";

          /* checkbox (pre-checked) */
          const checkbox = document.createElement("input");
          checkbox.type  = "checkbox";
          checkbox.checked = true;
          checkbox.onchange = () => {              // un-ticking ⇒ delete everywhere
              selectedGameIds.delete(game_id);
              delete selectedGamesInfo[game_id];
              localStorage.setItem("selectedGameIds", JSON.stringify(Array.from(selectedGameIds)));
              localStorage.setItem("selectedGamesInfo", JSON.stringify(selectedGamesInfo));
              card.remove();                       // vanish instantly
              /* optional: inform original window so its checkboxes update */
              if (window.opener) window.opener.dispatchEvent(new Event("storage"));
          };
          card.appendChild(checkbox);

          /* header with logos & title */
          const header = document.createElement("div");
          header.className = "game-header";

          const logo1 = document.createElement("img");
          logo1.className = "team-logo";
          logo1.src = teamLogos[away_team] || "";
          logo1.alt = away_team;

          const logo2 = document.createElement("img");
          logo2.className = "team-logo";
          logo2.src = teamLogos[home_team] || "";
          logo2.alt = home_team;

          const title = document.createElement("div");
          title.className = "game-title";
          title.innerText = `${away_team} vs ${home_team}`;

          header.appendChild(logo1);
          header.appendChild(title);
          header.appendChild(logo2);
          card.appendChild(header);

          /* meta line */
          const meta = document.createElement("div");
          meta.className = "game-meta";
          meta.innerText = `${date} – ${location} – ${hour}`;
          card.appendChild(meta);

          container.appendChild(card);
      });
  }
  renderCards();

  /* if main window changes storage while popup is open, refresh automatically */
  window.addEventListener("storage", renderCards);
  </script>
</body>
</html>
